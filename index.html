<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link href="https://fonts.googleapis.com/css?family=Raleway:300,400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400" rel="stylesheet">
    <link rel="stylesheet" href="assets/main.css" media="screen" title="no title">
    <!-- <link rel="stylesheet" href="assets/chartist.min.css" media="screen" title="no title"> -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="assets/jquery.min.js"></script>
    <script type="text/javascript" src="assets/vue.min.js"></script>
  </head>
  <body>
    <div id="app">
      <nav id="menu" class="col-md-2" v-bind:class="activeNav" v-on:click.prevent>
        <div class="top-menu">
          Balance {{ balance }} ETH
        </div>
        <ul>
          <li class="buy-options active" v-on:click="makeActiveNav('buy-options')">Buy Options</li>
          <li class="active-orders" v-on:click="makeActiveNav('active-orders')">Active Orders</li>
          <li class="history" v-on:click="makeActiveNav('history')">History</li>
          <li class="help" v-on:click="makeActiveNav('help')">How to works?</li>
        </ul>
      </nav>

      <section id="menu-open-bar" class="col-md-3">
        <div class="search">
          <input type="text" v-model="searchString" placeholder="Search by pair or market name" />
        </div>
        <script type="text/javascript">
          function displayNumber(n) {
            if ( (Math.round( n * 100 ) / 100).toFixed(2) == n ) {
              return (Math.round( n * 100 ) / 100).toFixed(2);
            } else {
              var nLength = n.toString().replace('.', '').length;
              if (nLength > 8) {
                return parseFloat(n.toString().slice(0, 8-nLength));
              } else {
                return n;
              }
            }
          }

        </script>
        <ul v-for="pairSearchData in filteredPairs" v-on:click.prevent>
          <span class="pair-data" v-show.visible="false">{{ pair = pairs[pairSearchData.id] }}</span>
          <li class="pair" v-bind:class="pairSearchData.id" v-on:click="makeActivePair(pairSearchData.id)">
            <ul>
              <li class="name">
                {{ pair.name }}
                <span>{{ pair.exchange }}</span>
              </li>
              <li class="mini-graph">
                show graph here
              </li>
              <li class="price" v-if="pair.change >= 0">
                {{ displayNumber( pair.price ) }}
              </li>
              <li class="price red" v-else>
                {{ displayNumber( pair.price ) }}
              </li>
            </ul>
          </li>
        </ul>
      </section>

      <section id="content" class="col-md-7" v-bind:class="activePair">
        <span class="pair-data" v-show.visible="false">{{ pair = pairs[activePair] }}</span>
        <section class="header">
          <ul class="left">
            <li class="price">
              {{ displayNumber( pair.price ) }}
            </li>
            <li class="price-change" v-if="pair.change >= 0">
              +5.23 ({{ pair.change }}%)
            </li>
            <li class="price-change red" v-else>
              -5.23 ({{ pair.change }}%)
            </li>
          </ul>
          <ul class="right">
            <li class="pair-name">
              {{ pair.name }}
            </li>
            <li class="exchange">
              {{ pair.exchange }}
            </li>
          </ul>
        </section>
        <section class="graph">
          <canvas id="sparkline" width="100%" height="100%" style="z-index: 100;">
            Your browser does not support the HTML5 canvas tag. Please upgrade your browser. We reccomend you install <a href="https://www.google.com/chrome/browser/desktop/">Google Chrome</a>
          </canvas>
          <nav class="time-frame-menu">
            <ul>
              <li class="1-day active" v-on:click="makeActiveTimeFrame('1-day')">1 day</li>
              <li class="1-week" v-on:click="makeActiveTimeFrame('1-week')">1 week</li>
              <li class="1-month" v-on:click="makeActiveTimeFrame('1-month')">1 month</li>
              <li class="3-month" v-on:click="makeActiveTimeFrame('3-month')">3 months</li>
              <li class="6-month" v-on:click="makeActiveTimeFrame('6-month')">6 months</li>
              <li class="1-year" v-on:click="makeActiveTimeFrame('1-year')">1 year</li>
            </ul>
          </nav>
        </section>
        <section class="footer">

        </section>
      </section>
    </div>

    <script type="text/javascript" src="assets/app.js"></script>
    <script src="assets/socket.io-1.4.5.js"></script>
    <script src="assets/autobahn.min.js"></script>
    <script type="text/javascript" src="assets/updateData.js"></script>
    <script src="assets/sparkline.js"></script>

    <script type="text/javascript" src="assets/web3.min.js"></script>
    <script type="text/javascript">
    window.addEventListener('load', function() {
      // Checking if Web3 has been injected by the browser (Mist/MetaMask)
      if (typeof web3 !== 'undefined') {
        // Use Mist/MetaMask's provider
        web3 = new Web3(web3.currentProvider);
      } else {
        alert('No web3? You should consider trying MetaMask!');
        // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
        web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
      }
      if(!web3.isConnected()) {
       alert("Couldn't connect to a node...");
      }

      var account = web3.eth.accounts[0];
      // console.log(web3.version.ethereum);
      // console.log(web3.version.network);

      // Listens for Selected Account Changes
      var accountInterval = setInterval(function() {
        if (web3.eth.accounts[0] !== account) {
          account = web3.eth.accounts[0];
          updateInterface();
        }
      }, 100);

      var balance = null;
      function updateBalance() {
        web3.eth.getBalance( account, function(error, result) {
          if (!error) {
            updateBalanceCallback(result);
          } else {
            updateBalance();
          }
        });
      }
      updateBalance();

      function updateBalanceCallback(result) {
        var balanceWei = result.toNumber();
        balance = parseFloat(web3.fromWei(balanceWei, 'ether'));
        app.balance = balance.toFixed(3);
      }

      var network = null;
      function connectedNetwork() {
        web3.eth.getBlock(0, function (error, result) {
          if (result.hash === "0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3") {
            // TODO: Check whether it is ETC or ETH
            network = "mainnet";
          } else if (result.hash === "0x0cd786a2425d16f152c658316c423e6ce1181e15c3295826d7c9904cba9ce303") {
            network = "testnet";
          } else {
            network = "private";
          }
        });
      }

      var abi = [{"constant":false,"inputs":[{"name":"amountInEther","type":"uint256"}],"name":"brokerWithdrawl","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"myid","type":"bytes32"},{"name":"result","type":"string"},{"name":"proof","type":"bytes"}],"name":"__callback","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[{"name":"withdrawalBalance","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"secondsToExpiration","type":"uint256"}],"name":"externalPutRequest","outputs":[],"payable":true,"type":"function"},{"constant":true,"inputs":[],"name":"ETHUSD","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"returnRate","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"brokerDeposit","outputs":[{"name":"balance","type":"uint256"}],"payable":true,"type":"function"},{"constant":false,"inputs":[],"name":"deposit","outputs":[],"payable":true,"type":"function"},{"constant":false,"inputs":[{"name":"newReturnRate","type":"uint256"}],"name":"updateReturnRate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"secondsToExpiration","type":"uint256"}],"name":"externalCallRequest","outputs":[],"payable":true,"type":"function"},{"inputs":[{"name":"_returnRate","type":"uint256"}],"type":"constructor"},{"payable":false,"type":"fallback"}];

      var binarytradingContract = web3.eth.contract(abi).at("0x5caD3cBdbf64B65174b36269f5201d3265569F2B");

      var returnRate = binarytradingContract.returnRate.call(function(error, result){
        console.log(result);
      });

      // watch for an event
      // var myEvent = myContractInstance.MyEvent({some: 'args'}, additionalFilterObject);
      // myEvent.watch(function(error, result){
      //    ...
      // });
      //
      // // would get all past logs again.
      // var myResults = myEvent.get();

    });
    </script>

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  </body>
</html>
