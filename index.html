<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link rel="stylesheet" href="assets/main.css" media="screen" title="no title">
    <!-- <link rel="stylesheet" href="assets/chartist.min.css" media="screen" title="no title"> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  </head>
  <body>
    <nav>
      <div class="nav-top">
        <ul>
          <li><span id="user-balance"></span> ETH</li>
        </ul>
      </div>
      <div class="nav-bottom">
        <span>.nav-bottom</span>
      </div>
    </nav>

    <div><span id="live-price"></span> mBTC</div>

    <!-- TODO: Make a background like this one: http://faucet.etherparty.io/ -->

    <canvas id="sparkline" width="100%" height="100%" data-sparkline="1,2,3,4,5,5.5,5.8,6,5.4,4.8,3,2,2,6,7,8,9,10,10,7,6,7,7,8,9">
      Your browser does not support the HTML5 canvas tag. Please upgrade your browser. We reccomend you install <a href="https://www.google.com/chrome/browser/desktop/">Google Chrome</a>
    </canvas>

    <div id="control-panel">
      <input type="number" name="bet" value="">
      <div class="button green">Put</div>
      <div class="button red">Call</div>
    </div>

    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script src="https://autobahn.s3.amazonaws.com/autobahnjs/latest/autobahn.min.js"></script>
    <script type="text/javascript" src="assets/sparkline.js"></script>

    <script type="text/javascript" src="assets/web3.min.js">

    </script>
    <script type="text/javascript">
    window.addEventListener('load', function() {
      // Checking if Web3 has been injected by the browser (Mist/MetaMask)
      if (typeof web3 !== 'undefined') {
        // Use Mist/MetaMask's provider
        web3 = new Web3(web3.currentProvider);
      } else {
        alert('No web3? You should consider trying MetaMask!');
        // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
        web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
      }
      if(!web3.isConnected()) {
       alert("Couldn't connect to a node...");
      }

      var account = web3.eth.accounts[0];
      // console.log(web3.version.ethereum);
      // console.log(web3.version.network);

      // Listens for Selected Account Changes
      var accountInterval = setInterval(function() {
        if (web3.eth.accounts[0] !== account) {
          account = web3.eth.accounts[0];
          updateInterface();
        }
      }, 100);

      var balance = null;
      function updateBalance() {
        web3.eth.getBalance( account, function(error, result) {
          if (!error) {
            updateBalanceCallback(result);
          } else {
            updateBalance();
          }
        });
      }
      updateBalance();

      function updateBalanceCallback(result) {
        var balanceWei = result.toNumber();
        balance = web3.fromWei(balanceWei, 'ether');
        $("#user-balance").text(balance);
      }

      var network = null;
      function connectedNetwork() {
        web3.eth.getBlock(0, function (error, result) {
          if (result.hash === "0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3") {
            network = "mainnet";
          } else if (result.hash === "0x0cd786a2425d16f152c658316c423e6ce1181e15c3295826d7c9904cba9ce303") {
            network = "testnet";
          } else {
            network = "private";
          }
        });
      }

      var binarytradingContract = web3.eth.contract([{"constant":false,"inputs":[{"name":"amountInEther","type":"uint256"}],"name":"brokerWithdrawl","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"myid","type":"bytes32"},{"name":"result","type":"string"},{"name":"proof","type":"bytes"}],"name":"__callback","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[{"name":"withdrawalBalance","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"secondsToExpiration","type":"uint256"}],"name":"externalPutRequest","outputs":[],"payable":true,"type":"function"},{"constant":true,"inputs":[],"name":"ETHUSD","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"returnRate","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"brokerDeposit","outputs":[{"name":"balance","type":"uint256"}],"payable":true,"type":"function"},{"constant":false,"inputs":[],"name":"deposit","outputs":[],"payable":true,"type":"function"},{"constant":false,"inputs":[{"name":"newReturnRate","type":"uint256"}],"name":"updateReturnRate","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"secondsToExpiration","type":"uint256"}],"name":"externalCallRequest","outputs":[],"payable":true,"type":"function"},{"inputs":[{"name":"_returnRate","type":"uint256"}],"type":"constructor"},{"payable":false,"type":"fallback"}]).at("0x5caD3cBdbf64B65174b36269f5201d3265569F2B");

      var returnRate = binarytradingContract.returnRate.call(function(error, result){
        console.log(result);
      });

    });
    </script>
  </body>
</html>
